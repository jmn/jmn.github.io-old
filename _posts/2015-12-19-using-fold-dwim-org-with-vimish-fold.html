---
title: Emacs: using fold-dwim-org with vimish-fold
layout: post
on: 2015-12-19 17:14
CATEGORY: notes
---

<p>
A lazy way to fold code with tab.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp
">     (defun fold-dwim-org/toggle (&amp;optional key lst-point)
       "Hide or show a block."
       (interactive)
         (let* ((last-point (or lst-point (point)))
		(fold-dwim-org/minor-mode nil)
		(command (if key (key-binding key) nil))
		(other-keys fold-dwim-org/trigger-keys-block))
           (unless command
             (setq command 'indent-for-tab-command))
           (while (and (null command)
                       (not (null other-keys)))
             (setq command (key-binding (car other-keys)))
             (setq other-keys (cdr other-keys)))
           (unless lst-point
             (if (commandp command)
                 (call-interactively command)))
           (let ((ref-point
                  ;; Workaround for cases when the point is at the beginning of the line
                  (save-excursion
                    (when fold-dwim-org-strict
			(progn
                          (back-to-indentation)
                          (and (not (looking-at "$"))
                               (forward-char 1))))
                    (point))))
             (when (fold-dwim-org/should-fold-p last-point ref-point (point))
               (save-excursion
                 (goto-char ref-point)
                 (fold-dwim-toggle)))
             (vimish-fold-toggle)))) ;; ADDED THIS LINE
</pre>
</div>

<p>
Update: Screw this. above let's go with:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp
">;; Toggle vimish-fold with Tab key.
(defadvice fold-dwim-org/toggle (after my-fold-dwim-org/toggle (&amp;optional key lst-point) activate)
  "Call vimish-fold-toggle after fold-dwim-org/toggle"
  (vimish-fold-toggle)
  )
</pre>
</div>

<p>
(<a href="http://rawsyntax.com/blog/learn-emacs-use-defadvice-modify-functions/">Source</a>)
</p>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><a href="http://www.jmnorlund.net{{ page.url }}"><span class="section-number-2">1</span> Background:</a></h2>
<div class="outline-text-2" id="text-1">
<p>
<code>fold-dwim-org/minor-mode</code> is a fairly simple way to achieve code folding in some Emacs programming modes. For example emacs lisp expressions can be folded by pressing the Tab key. However for modes that are not immediately supported by fold-dwim-org, it may be nice to use the mode <code>vimish-fold</code> to achieve folding. By modifying the function <code>fold-dwim-org/toggle</code> to apply <code>vimish-fold-toggle</code>, it is simple to toggle the folding state (using Tab key) if there is a vimish-folding fold under the cursor. I hope you're happy now.
</p>

<p>
<code>vimish-fold</code> 
</p>
<ul class="org-ul">
<li>vimish-fold
</li>
<li>fold-dwim-org
<a href="file://c:/users/jmn/.emacs.d/elpa/fold-dwim-org-20131203.551/fold-dwim-org.el">file://c:/users/jmn/.emacs.d/elpa/fold-dwim-org-20131203.551/fold-dwim-org.el</a>
</li>
</ul>
</div>
</div>
