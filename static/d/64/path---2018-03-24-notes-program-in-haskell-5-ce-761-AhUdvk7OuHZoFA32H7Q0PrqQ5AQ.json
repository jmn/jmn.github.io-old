{"data":{"markdownRemark":{"html":"<p>A small Haskell program that manages short notes in a SQLite database. Uses <a href=\"https://hackage.haskell.org/package/sqlite-simple\">sqlite-simple</a> and <a href=\"https://hackage.haskell.org/package/cmdargs\">CmdArgs</a>.</p>\n<!--more-->\n<div class=\"gatsby-highlight\" data-language=\"haskell\"><pre class=\"language-haskell\"><code class=\"language-haskell\"><span class=\"token comment\">{-# LANGUAGE OverloadedStrings #-}</span>\n<span class=\"token comment\">{-# LANGUAGE DeriveDataTypeable #-}</span>\n\n<span class=\"token keyword\">module</span> <span class=\"token constant\">Main</span> <span class=\"token keyword\">where</span>\n\n<span class=\"token import_statement\"><span class=\"token keyword\">import</span> System.Environment</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">getArgs</span><span class=\"token punctuation\">)</span>\n<span class=\"token import_statement\"><span class=\"token keyword\">import</span> Database.SQLite.Simple</span>\n<span class=\"token import_statement\"><span class=\"token keyword\">import</span> System.Console.CmdArgs</span>\n<span class=\"token import_statement\"><span class=\"token keyword\">import</span> Data.List <span class=\"token keyword\">hiding</span></span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">delete</span><span class=\"token punctuation\">)</span>\n<span class=\"token import_statement\"><span class=\"token keyword\">import</span> Data.Time.Format.Human</span>\n<span class=\"token import_statement\"><span class=\"token keyword\">import</span> Data.Time</span>\n<span class=\"token import_statement\"><span class=\"token keyword\">import</span> Data.Time.Format</span>\n<span class=\"token import_statement\"><span class=\"token keyword\">import</span> Control.Monad</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">when</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">data</span> <span class=\"token constant\">Options</span> <span class=\"token operator\">=</span> <span class=\"token constant\">Options</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token hvariable\">inputMode</span> <span class=\"token operator\">::</span> <span class=\"token constant\">Bool</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">message</span> <span class=\"token operator\">::</span> <span class=\"token constant\">String</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">delete</span> <span class=\"token operator\">::</span> <span class=\"token constant\">Integer</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">humanTime</span> <span class=\"token operator\">::</span> <span class=\"token constant\">Bool</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">tags</span> <span class=\"token operator\">::</span> <span class=\"token constant\">Maybe</span> <span class=\"token constant\">String</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">update</span> <span class=\"token operator\">::</span> <span class=\"token constant\">Integer</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">showTag</span> <span class=\"token operator\">::</span> <span class=\"token constant\">Maybe</span> <span class=\"token constant\">String</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">deriving</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">Data</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">Typeable</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token hvariable\">options</span> <span class=\"token operator\">::</span> <span class=\"token constant\">Options</span>\n<span class=\"token hvariable\">options</span> <span class=\"token operator\">=</span>\n    <span class=\"token constant\">Options</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token hvariable\">inputMode</span> <span class=\"token operator\">=</span> <span class=\"token constant\">False</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">typ</span> <span class=\"token string\">\"Input mode\"</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">help</span> <span class=\"token string\">\"Toggle input mode\"</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">message</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">def</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">typ</span> <span class=\"token string\">\"message\"</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">opt</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span> <span class=\"token operator\">::</span> <span class=\"token constant\">String</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">args</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">delete</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">def</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">typ</span> <span class=\"token string\">\"[number]\"</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">help</span> <span class=\"token string\">\"Delete a note.\"</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">humanTime</span> <span class=\"token operator\">=</span>\n        <span class=\"token constant\">False</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">typ</span> <span class=\"token string\">\"Relative time\"</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">help</span> <span class=\"token string\">\"Show time relative to now in human readable format.\"</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">tags</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">def</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">typ</span> <span class=\"token string\">\"tags\"</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">help</span> <span class=\"token string\">\"Tag a note.\"</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">update</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">def</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">typ</span> <span class=\"token string\">\"[number]\"</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">help</span> <span class=\"token string\">\"Modify a note.\"</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">showTag</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">def</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">typ</span> <span class=\"token string\">\"TAG\"</span> <span class=\"token operator\">&amp;=</span> <span class=\"token hvariable\">help</span> <span class=\"token string\">\"Show entries with given tag.\"</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token operator\">&amp;=</span>\n    <span class=\"token hvariable\">summary</span> <span class=\"token string\">\"n notes\"</span> <span class=\"token operator\">&amp;=</span>\n    <span class=\"token hvariable\">program</span> <span class=\"token string\">\"n\"</span>\n\n<span class=\"token keyword\">data</span> <span class=\"token constant\">TestField</span> <span class=\"token operator\">=</span> <span class=\"token constant\">TestField</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token hvariable\">id_</span> <span class=\"token operator\">::</span> <span class=\"token constant\">Int</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">time</span> <span class=\"token operator\">::</span> <span class=\"token constant\">String</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">note</span> <span class=\"token operator\">::</span> <span class=\"token constant\">String</span>\n    <span class=\"token punctuation\">,</span> <span class=\"token hvariable\">tags</span>' <span class=\"token operator\">::</span> <span class=\"token constant\">Maybe</span> <span class=\"token constant\">String</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">deriving</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">Show</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">instance</span> <span class=\"token constant\">FromRow</span> <span class=\"token constant\">TestField</span> <span class=\"token keyword\">where</span>\n    <span class=\"token hvariable\">fromRow</span> <span class=\"token operator\">=</span> <span class=\"token constant\">TestField</span> <span class=\"token operator\">&lt;$></span> <span class=\"token hvariable\">field</span> <span class=\"token operator\">&lt;*></span> <span class=\"token hvariable\">field</span> <span class=\"token operator\">&lt;*></span> <span class=\"token hvariable\">field</span> <span class=\"token operator\">&lt;*></span> <span class=\"token hvariable\">field</span>\n\n<span class=\"token keyword\">instance</span> <span class=\"token constant\">ToRow</span> <span class=\"token constant\">TestField</span> <span class=\"token keyword\">where</span>\n    <span class=\"token hvariable\">toRow</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">TestField</span> <span class=\"token hvariable\">id_</span> <span class=\"token hvariable\">date_added</span> <span class=\"token hvariable\">str</span> <span class=\"token hvariable\">str</span>'<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">toRow</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">id_</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">date_added</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">str</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">str</span>'<span class=\"token punctuation\">)</span>\n\n<span class=\"token hvariable\">dbPut</span> <span class=\"token operator\">::</span> <span class=\"token constant\">Connection</span> <span class=\"token operator\">-></span> <span class=\"token constant\">String</span> <span class=\"token operator\">-></span> <span class=\"token constant\">Maybe</span> <span class=\"token constant\">String</span> <span class=\"token operator\">-></span> <span class=\"token constant\">IO</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token hvariable\">dbPut</span> <span class=\"token hvariable\">conn</span> <span class=\"token hvariable\">val</span> <span class=\"token hvariable\">mTags</span> <span class=\"token operator\">=</span>\n    <span class=\"token keyword\">case</span> <span class=\"token hvariable\">mTags</span> <span class=\"token keyword\">of</span>\n        <span class=\"token constant\">Nothing</span> <span class=\"token operator\">-></span>\n            <span class=\"token hvariable\">execute</span>\n                <span class=\"token hvariable\">conn</span>\n                <span class=\"token string\">\"INSERT INTO test (date_added, str) \\\n        \\VALUES (datetime('now'), ?)\"</span>\n                <span class=\"token punctuation\">(</span><span class=\"token constant\">Only</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">val</span> <span class=\"token operator\">::</span> <span class=\"token constant\">String</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token hvariable\">tags</span> <span class=\"token operator\">-></span>\n            <span class=\"token hvariable\">execute</span>\n                <span class=\"token hvariable\">conn</span>\n                <span class=\"token string\">\"INSERT INTO test (date_added, str, tags) \\\n        \\VALUES (datetime('now'), ?, ?)\"</span>\n                <span class=\"token punctuation\">(</span><span class=\"token hvariable\">val</span> <span class=\"token operator\">::</span> <span class=\"token constant\">String</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">tags</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token hvariable\">deleteRecord</span> <span class=\"token operator\">::</span> <span class=\"token constant\">Connection</span> <span class=\"token operator\">-></span> <span class=\"token constant\">Integer</span> <span class=\"token operator\">-></span> <span class=\"token constant\">IO</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token hvariable\">deleteRecord</span> <span class=\"token hvariable\">conn</span> <span class=\"token hvariable\">x</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">execute</span> <span class=\"token hvariable\">conn</span> <span class=\"token string\">\"DELETE FROM test WHERE ID = (?)\"</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">Only</span> <span class=\"token hvariable\">x</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token hvariable\">showNote</span> <span class=\"token operator\">::</span> <span class=\"token constant\">Bool</span> <span class=\"token operator\">-></span> <span class=\"token constant\">TestField</span> <span class=\"token operator\">-></span> <span class=\"token constant\">IO</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token hvariable\">showNote</span> <span class=\"token hvariable\">humanizeTime</span> <span class=\"token hvariable\">x</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">do</span>\n    <span class=\"token hvariable\">time</span>' <span class=\"token operator\">&lt;-</span> <span class=\"token keyword\">if</span> <span class=\"token hvariable\">humanizeTime</span> <span class=\"token keyword\">then</span>\n        <span class=\"token keyword\">do</span> <span class=\"token keyword\">let</span> <span class=\"token hvariable\">t</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">parseTimeOrError</span> <span class=\"token constant\">False</span> <span class=\"token hvariable\">defaultTimeLocale</span> <span class=\"token string\">\"%F %T\"</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">time</span> <span class=\"token hvariable\">x</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">::</span> <span class=\"token constant\">UTCTime</span>\n           <span class=\"token hvariable\">humanReadableTime</span> <span class=\"token hvariable\">t</span>\n    <span class=\"token keyword\">else</span>\n           <span class=\"token builtin\">return</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">time</span> <span class=\"token hvariable\">x</span><span class=\"token punctuation\">)</span>\n    <span class=\"token hvariable\">t</span> <span class=\"token operator\">&lt;-</span>\n        <span class=\"token keyword\">case</span> <span class=\"token hvariable\">tags</span>' <span class=\"token hvariable\">x</span> <span class=\"token keyword\">of</span>\n            <span class=\"token constant\">Nothing</span> <span class=\"token operator\">-></span> <span class=\"token builtin\">return</span> <span class=\"token string\">\"\"</span>\n            <span class=\"token constant\">Just</span> <span class=\"token hvariable\">xs</span> <span class=\"token operator\">-></span> <span class=\"token builtin\">return</span> <span class=\"token operator\">$</span> <span class=\"token string\">\"#\"</span> <span class=\"token operator\">++</span> <span class=\"token hvariable\">xs</span>\n\n    <span class=\"token keyword\">let</span> <span class=\"token hvariable\">msg</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">note</span> <span class=\"token hvariable\">x</span> <span class=\"token operator\">++</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">++</span> <span class=\"token hvariable\">t</span>\n    <span class=\"token keyword\">let</span> <span class=\"token hvariable\">o</span> <span class=\"token operator\">=</span> <span class=\"token hvariable\">intercalate</span> <span class=\"token string\">\" | \"</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">show</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">id_</span> <span class=\"token hvariable\">x</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token hvariable\">time</span>'<span class=\"token punctuation\">,</span> <span class=\"token hvariable\">msg</span><span class=\"token punctuation\">]</span>\n    <span class=\"token builtin\">print</span> <span class=\"token hvariable\">o</span>\n\n<span class=\"token hvariable\">createTable</span> <span class=\"token hvariable\">conn</span> <span class=\"token operator\">=</span>\n    <span class=\"token hvariable\">execute_</span>\n        <span class=\"token hvariable\">conn</span>\n        <span class=\"token string\">\"CREATE TABLE IF NOT EXISTS \\\n        \\test (id INTEGER PRIMARY KEY, \\\n        \\date_added DATETIME DEFAULT CURRENT_TIMESTAMP, \\\n        \\str TEXT, \\\n        \\tags TEXT)\"</span>\n\n<span class=\"token hvariable\">main</span> <span class=\"token operator\">::</span> <span class=\"token constant\">IO</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token hvariable\">main</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">do</span>\n    <span class=\"token hvariable\">opts</span> <span class=\"token operator\">&lt;-</span> <span class=\"token hvariable\">cmdArgs</span> <span class=\"token hvariable\">options</span>\n    <span class=\"token hvariable\">conn</span> <span class=\"token operator\">&lt;-</span> <span class=\"token hvariable\">open</span> <span class=\"token string\">\"test.db\"</span>\n    <span class=\"token hvariable\">createTable</span> <span class=\"token hvariable\">conn</span>\n    <span class=\"token hvariable\">when</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">delete</span> <span class=\"token hvariable\">opts</span> <span class=\"token operator\">/=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">deleteRecord</span> <span class=\"token hvariable\">conn</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">delete</span> <span class=\"token hvariable\">opts</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token hvariable\">when</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">message</span> <span class=\"token hvariable\">opts</span> <span class=\"token operator\">/=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">dbPut</span> <span class=\"token hvariable\">conn</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">message</span> <span class=\"token hvariable\">opts</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">tags</span> <span class=\"token hvariable\">opts</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token hvariable\">when</span>\n        <span class=\"token punctuation\">(</span><span class=\"token hvariable\">inputMode</span> <span class=\"token hvariable\">opts</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">do</span> <span class=\"token hvariable\">content</span> <span class=\"token operator\">&lt;-</span> <span class=\"token builtin\">getContents</span>\n            <span class=\"token hvariable\">dbPut</span> <span class=\"token hvariable\">conn</span> <span class=\"token hvariable\">content</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">tags</span> <span class=\"token hvariable\">opts</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token hvariable\">r</span> <span class=\"token operator\">&lt;-</span>\n        <span class=\"token keyword\">case</span> <span class=\"token hvariable\">showTag</span> <span class=\"token hvariable\">opts</span> <span class=\"token keyword\">of</span>\n            <span class=\"token constant\">Nothing</span> <span class=\"token operator\">-></span> <span class=\"token hvariable\">query_</span> <span class=\"token hvariable\">conn</span> <span class=\"token string\">\"SELECT * from test\"</span> <span class=\"token operator\">::</span> <span class=\"token constant\">IO</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">TestField</span><span class=\"token punctuation\">]</span>\n            <span class=\"token constant\">Just</span> <span class=\"token hvariable\">x</span> <span class=\"token operator\">-></span> <span class=\"token hvariable\">query</span> <span class=\"token hvariable\">conn</span> <span class=\"token string\">\"SELECT * from test WHERE tags LIKE ?\"</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">Only</span> <span class=\"token hvariable\">x</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">::</span> <span class=\"token constant\">IO</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">TestField</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">if</span> <span class=\"token hvariable\">humanTime</span> <span class=\"token hvariable\">opts</span>\n        <span class=\"token keyword\">then</span> <span class=\"token builtin\">mapM_</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">showNote</span> <span class=\"token constant\">True</span><span class=\"token punctuation\">)</span> <span class=\"token hvariable\">r</span>\n        <span class=\"token keyword\">else</span> <span class=\"token builtin\">mapM_</span> <span class=\"token punctuation\">(</span><span class=\"token hvariable\">showNote</span> <span class=\"token constant\">False</span><span class=\"token punctuation\">)</span> <span class=\"token hvariable\">r</span>\n    <span class=\"token hvariable\">close</span> <span class=\"token hvariable\">conn</span></code></pre></div>","frontmatter":{"title":"Note recording Haskell program"},"fields":{"date":"2018-03-24"}}},"pageContext":{"slug":"/2018/03/24/notes-program-in-haskell/"}}